<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prenotazione - Eleven Cocktail Bar</title>

  <style>
    :root{ --gold:#f6bf1a; --txt:#ffffff; }

    html, body{
      margin:0;
      background: transparent !important;
      color: var(--txt);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    .wrap{ max-width:720px; margin:0 auto; padding:24px; background: transparent; }

    .card{
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      border-left:6px solid var(--gold);
      border-radius:18px;
      padding:18px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    h1{ margin:0 0 10px; font-size:22px; font-weight:900; color:#fff; }
    p{ margin:0 0 18px; color:#fff; opacity:.95; }
    b{ color: var(--gold); }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    label{ display:block; font-size:13px; margin-bottom:6px; color:#fff; }

    input, textarea, select{
      width:100%;
      box-sizing:border-box;
      display:block;

      min-height:48px;
      height:48px;
      padding:12px;

      border-radius:12px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.45);
      color:#fff !important;

      line-height:24px;
      outline:none;

      -webkit-appearance:none;
      -moz-appearance:none;
      appearance:none;
    }

    textarea{
      min-height:96px;
      height:auto;
      resize:vertical;
      line-height:22px;
    }

    input[type="date"], input[type="time"]{
      padding:12px;
      min-height:48px;
      height:48px;
      line-height:24px;
    }

    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator{
      opacity:.85;
      cursor:pointer;
    }

    ::placeholder{ color:rgba(255,255,255,.7); }

    input:focus, textarea:focus, select:focus{
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(246,191,26,.25);
    }

    .full{ grid-column:1 / -1; }

    .btn{
      padding:12px 16px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(246,191,26,.25);
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .btn:hover{ background: rgba(246,191,26,.35); }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; }

    .row{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-top:14px;
    }

    .status{
      font-size:13px;
      color:#fff;
      max-width:420px;
      text-align:right;
    }

    .ok{ color:#7ee787; }
    .err{ color:#ff7b72; }

    @media(max-width:640px){
      .grid{ grid-template-columns:1fr; }
      .row{ flex-direction:column; align-items:stretch; }
      .status{ max-width:100%; text-align:left; }
    }

    /* ===== POPUP (MODAL) ===== */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }
    .modal{
      width: min(560px, 100%);
      background: rgba(0,0,0,.85);
      border: 1px solid rgba(255,255,255,.18);
      border-left: 6px solid var(--gold);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.5);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: #fff;
    }
    .modal h2{
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
      color: var(--gold);
      letter-spacing: .5px;
    }
    .modal .text{
      white-space: pre-line;
      line-height: 1.45;
      opacity: .98;
      font-size: 14px;
    }
    .modal .actions{
      margin-top: 14px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    .modal .btn-close{
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.08);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
    }
    .modal .btn-close:hover{
      background: rgba(255,255,255,.14);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Prenota un tavolo</h1>
      <p>Compila il modulo e premi <b>Conferma prenotazione</b>. Riceverai una risposta appena possibile.</p>

      <form id="bookingForm">
        <div class="grid">

          <div class="full">
            <label>Nome e cognome *</label>
            <input id="in_nome" placeholder="Es. Mario Rossi" required>
          </div>

          <div>
            <label>Data *</label>
            <input id="in_data" type="date" required>
          </div>

          <div>
            <label>Orario *</label>
            <input id="in_ora" type="time" required>
          </div>

          <div>
            <label>Numero persone *</label>
            <select id="in_persone" required>
              <option value="">Seleziona</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option><option>10</option>
            </select>
          </div>

          <div>
            <label>Telefono *</label>
            <input id="in_tel" placeholder="Es. +39 333 1234567" required>
          </div>

          <div class="full">
            <label>Email *</label>
            <input id="in_email" type="email" placeholder="Es. nome@email.it" required>
          </div>

          <div class="full">
            <label>Note (facoltative)</label>
            <textarea id="in_note" placeholder="Es. compleanno, allergie, richieste particolari..."></textarea>
          </div>

        </div>

        <div class="row">
          <button id="btnSend" class="btn" type="submit">Conferma prenotazione</button>
          <div id="status" class="status"></div>
        </div>
      </form>
    </div>
  </div>

  <!-- POPUP -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <h2 id="modalTitle">Prenotazione inviata</h2>
      <div id="modalText" class="text"></div>
      <div class="actions">
        <button id="btnCloseModal" class="btn-close" type="button">Chiudi</button>
      </div>
    </div>
  </div>

  <script>
    // ✅ NTFY: topic prenotazioni (booking)
    const NTFY_SERVER = "https://ntfy.sh";
    const NTFY_TOPIC  = "prenotazioni-eleven-cocktail-bar";

    const form   = document.getElementById("bookingForm");
    const status = document.getElementById("status");
    const btn    = document.getElementById("btnSend");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalText = document.getElementById("modalText");
    const btnCloseModal = document.getElementById("btnCloseModal");

    function setStatus(text, ok){
      status.textContent = text || "";
      status.className = "status " + (ok ? "ok" : "err");
    }

    function openModal(text){
      modalText.textContent = text;
      modalBackdrop.style.display = "flex";
      setTimeout(() => btnCloseModal.focus(), 0);
    }

    function closeModal(){
      modalBackdrop.style.display = "none";
    }

    btnCloseModal.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) closeModal();
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modalBackdrop.style.display === "flex") closeModal();
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      setStatus("", true);

      const nome = document.getElementById("in_nome").value.trim();
      const data = document.getElementById("in_data").value.trim();   // yyyy-mm-dd
      const ora  = document.getElementById("in_ora").value.trim();    // HH:MM
      const persone = document.getElementById("in_persone").value.trim();
      const tel  = document.getElementById("in_tel").value.trim();
      const email= document.getElementById("in_email").value.trim();
      const note = document.getElementById("in_note").value.trim();

      if(!nome || !data || !ora || !persone || !tel || !email){
        setStatus("Compila tutti i campi obbligatori.", false);
        return;
      }

      const msg =
`Nome: ${nome}
Data: ${data}
Ora: ${ora}
Persone: ${persone}
Email: ${email}
Telefono: ${tel}
${note ? "Note: " + note : ""}`.trim();

      btn.disabled = true;
      btn.textContent = "Invio...";

      try{
        const r = await fetch(`${NTFY_SERVER}/${NTFY_TOPIC}`, {
          method: "POST",
          headers: { "Title": "Nuova prenotazione", "Priority": "5" },
          body: msg
        });

        if(!r.ok){
          const t = await r.text().catch(()=> "");
          throw new Error("Errore invio (" + r.status + "): " + t);
        }

        // Data in IT (GG/MM/AAAA)
        let dataIT = data;
        try{
          if (data && data.includes("-")) {
            const [yy, mm, dd] = data.split("-");
            dataIT = `${dd}/${mm}/${yy}`;
          }
        }catch(e){}

        // ✅ Status corto (in basso a destra)
        setStatus("Prenotazione inviata correttamente riceverai la conferma a breve.", true);

        // ✅ Popup con testo completo
        const confirmText =
`Ciao ${nome}, ti confermiamo la tua prenotazione per ${persone} persone, ti aspettiamo il ${dataIT} alle ${ora} e ti ricordiamo che il tavolo viene riservato per 30 minuti oltre l'orario di prenotazione.

Dopo 30 minuti di ritardo il tavolo viene annullato per dare la possibilità ad altri ospiti di accomodarsi. Grazie per la prenotazione.

Buona giornata,
Manuel.`;

        openModal(confirmText);

        // reset SOLO dopo successo
        form.reset();
      }catch(err){
        console.error(err);
        setStatus("Errore: impossibile inviare la prenotazione. Riprova.", false);
      }finally{
        btn.disabled = false;
        btn.textContent = "Conferma prenotazione";
      }
    });
  </script>
</body>
</html>
